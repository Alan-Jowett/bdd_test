From d36f3023cd3da7144af6e8d190dabd0946f80fcf Mon Sep 17 00:00:00 2001
From: Alan Jowett <alan.jowett@microsoft.com>
Date: Mon, 10 Nov 2025 13:54:11 -0800
Subject: [PATCH] Fix memory leak in unique_table rehash function

Add missing std::free(oldBuckets) call to prevent memory leak
when hash table is resized.
---
 libteddy/details/hash_tables.hpp | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/libteddy/details/hash_tables.hpp b/libteddy/details/hash_tables.hpp
index 6557921..7f98ab6 100644
--- a/libteddy/details/hash_tables.hpp
+++ b/libteddy/details/hash_tables.hpp
@@ -624,6 +624,9 @@ auto unique_table<Data, Degree>::rehash(int64 const newCapacity) -> void
         }
     };

+    // Fix memory leak: free the old buckets array
+    std::free(oldBuckets);
+
 #ifdef LIBTEDDY_VERBOSE
     debug::out(", load after ", this->get_load_factor(), "\n");
 #endif
--
2.51.2.vfs.0.0